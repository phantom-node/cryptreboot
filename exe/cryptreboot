#!/usr/bin/env ruby
# frozen_string_literal: true

require 'bundler/setup'
require 'crypt_reboot'

config = CryptReboot::Config.instance
args = ARGV - ['--debug']
config.update!(patch_save_path: args.first, debug: ARGV.include?('--debug'))
boot_config = CryptReboot::BootConfig.new(kernel: config.kernel, initramfs: config.initramfs)

loader = CryptReboot::KexecPatchingLoader.new
loader.call(boot_config)
