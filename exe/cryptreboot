#!/usr/bin/env ruby
# frozen_string_literal: true

require 'bundler/setup'
require 'crypt_reboot'

args = ARGV - ['--verbose']

config = CryptReboot::Config.instance
config.save_patch = args.first
config.verbose = ARGV.include?('--verbose')

boot_config = CryptReboot::BootConfig.new(kernel: '/boot/vmlinuz',
                                          initramfs: '/boot/initrd.img')

loader = CryptReboot::KexecPatchingLoader.new
loader.call(boot_config)
